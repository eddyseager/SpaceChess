<!DOCTYPE HTML>
<html>
    <head>
        <script>
        		//game properties
        		var WIDTH = 500;
        		var HEIGHT = 500;
        		var OFFSET = 50;
        		
        		//create our planets
        		var planets = new Array();
        		planets[0] = new Planet(3, 3, 1);
        		planets[1] = new Planet(8, 8, 2);
        	  planets[2] = new Planet(3, 5, 0);
        		planets[3] = new Planet(8, 6, 0);
        	  
        		//create 2 players and a neutral player (for ownership of neutral
        		//planets       		
        		var players = new Array();
        		players[0] = new Player(0, "neutral", 0, "grey");
        		players[1] = new Player(1, "player 1", 10, "red");
        		players[2] = new Player(2, "player 2", 10, "yellow");
        		var playerTurn = 1;
        		var turnNumber = 1;
        		var isShipSelected = false;
        		var selectedLocation = {x: -1, y: -1};
        		
        		//create the ship types
        		var ShipClasses = new Object();
        		ShipClasses.Dreadnaught = new ShipType(10, 1, 6, "D");
        		ShipClasses.Corvette = new ShipType(10, 3, 3, "C");
        		ShipClasses.Hive = new ShipType(10, 1, 3, "H");
        		ShipClasses.Fighter = new ShipType(5, 1, 1, "f");
        		ShipClasses.Bomber = new ShipType(8, 1, 3, "b");
        		
        		//create a couple of ships
        		var ships = new Array();
        		ships[0] = new Ship("Dreadnaught", 1, 4, 3);
        		ships[1] = new Ship("Corvette", 2, 8, 8);
        		ships[2] = new Ship("Hive", 2, 1, 1);
        		ships[3] = new Ship("Fighter", 1, 10, 10);
	
        
            window.onload = function(){
                var canvas = document.getElementById("myCanvas");
                redraw();
                
                canvas.addEventListener('click', function(evt){
                		var mousePos = getMousePos(canvas, evt);
                		if (mousePos.x <= 10 && mousePos.y <= 10) {
                			processClick(mousePos);
                		}
                }, false);
            };
            
            function redraw() {
            	var canvas = document.getElementById("myCanvas");
               var context = canvas.getContext("2d");
              context.clearRect(0, 0, 800, 600);
 
               drawGrid(context);
               drawPlanets(context);
               drawText(context);
               drawShips(context);
            }
            
            function processClick(coord) {
            	//select a ship to move
            	if (!isShipSelected && isPlayerShip(coord)) {
            			selectedLocation = coord;
            			isShipSelected = true;
            			redraw();
            	} else if (isShipSelected && isPlayerShip(coord) && 
            		selectedLocation.x == coord.x && 
            		selectedLocation.y == coord.y) {
            		//unselect selected ship
            		selectedLocation = {x: -1, y:-1};
            		isShipSelected = false;
            		redraw();
            		} else if (isShipSelected && isWithinRange(coord.x, coord.y)
            			&& !isPlayerShip(coord)) {
            			var selShip = getSelectedShip();
            			selShip.x = coord.x;
            			selShip.y = coord.y;
            			isShipSelected = false;
            			endTurn();
            			redraw();
            		}
            }
            
            function endTurn() {
            	if (playerTurn == 1) {
            		playerTurn = 2;
            	} else {
            		playerTurn = 1;
            	}
            	
            	incrementResources();
            }
            
            function incrementResources() {
            	var count = 0;
            	
            	for (var i = 0; i < planets.length; i++) {
            		if (planets[i].player == playerTurn) {
            			count++;
            		}
            	}
            	
            	players[playerTurn].resources += count;
            }
            		
            
            function isPlayerShip(coord) {
            	for (var i = 0; i < ships.length; i++) {
            		if (ships[i].player == playerTurn && ships[i].x == coord.x &&
            			ships[i].y == coord.y) {
            				return true;
            		}
            	}
            	
            	return false;
            }
            	
            function drawGrid(context) {
            	context.moveTo(0, 0);
            	
            	//draw rectangles
            	for (var x = 1; x <= 10; x ++) {
            		for (var y = 1; y <= 10; y++) {
            			context.beginPath();
            	    context.rect((x-1) * OFFSET, (y-1) * OFFSET, OFFSET, OFFSET);
            	    
            	    context.fillStyle = "black";
            	    context.fill();
            	    if (isWithinRange(x, y)) {
            	    	context.lineWidth = 3;
            	    } else {
            	    	context.lineWidth = 1;
            	    }
            	    if (isWithinRange(x, y)) {
            	    	context.strokeStyle = "white";
            	    } else {
            	    	context.strokeStyle = "grey";
            	    }
            	    context.stroke();
            	  }
            	}
            	
            	//draw y axis labels
            	context.fillStyle = "grey";
            	context.font = "20px Arial";
            	for (var y = 1; y <= 10; y++) {
            		context.fillText(y, 510, (y * OFFSET) - (OFFSET / 4));
            	}
            	
            	//draw x axis labels
            	for (var x = 1; x <= 10; x++) {
            		context.fillText(x, (x * OFFSET) - (OFFSET / 4 * 3), 530);
            	}
            	
            }
            
            function isWithinRange(x, y) {
            	var selShip = getSelectedShip();
            	if (selShip == null) {
            		return false;
            	}
            	var range = ShipClasses[selShip.type].movement;
            	return Math.abs(x - selectedLocation.x) <= range
            		 && Math.abs(y - selectedLocation.y) <= range
            }
            
            function getSelectedShip() {
            	for (var i = 0; i < ships.length; i++) {
            		if (ships[i].x == selectedLocation.x &&
            			ships[i].y == selectedLocation.y) {
            				return ships[i];
            		}	
            	}
            	
            	return null;
            }
            
            function drawPlanets(context) {
            	for (var i = 0; i < planets.length; i++) {
            		context.beginPath();
            		context.arc((planets[i].x * OFFSET) - OFFSET/2, 
            			(planets[i].y * OFFSET) - OFFSET/2, 
            			20, 0, 2 * Math.PI, false);
            		context.fillStyle = players[planets[i].player].colour;
            		context.fill();
            		context.lineWidth = 1;
            		context.strokeStyle = "black";
            		context.stroke();            		
            	}
            }
            
            function drawText(context) {            	
            	//draw who's turn it is
            	context.font = "20px Arial";
            	context.fillStyle = players[playerTurn].colour;
            	context.fillText("Player " + playerTurn + "'s Turn", 600, 20);
            	
            	//draw the resources
            	context.font = "40px Arial";
            	context.fillStyle = players[1].colour;
            	context.fillText(players[1].resources, 600, 80);
            	context.fillStyle = players[2].colour;
            	context.fillText(players[2].resources, 670, 80);
            	
            	//draw info about selected ship
            	if (isShipSelected) {
            		context.font = "14px Arial";
            		context.fillStyle = players[playerTurn].colour;
            		var selShip = getSelectedShip();
            		var shipClass = ShipClasses[selShip.type];
            		context.fillText(selShip.type, 600, 120);
            	  context.font = "12px Arial";
            	  context.fillText("moves " + shipClass.movement, 600, 140);
            	  context.fillText("strength " + shipClass.strength, 600, 155);
            	}
            	
            }
            
            function drawShips(context) {
            	for (var i = 0; i < ships.length; i++) {
            		context.font = "32px Arial bold";
            		context.fillStyle = players[ships[i].player].colour;
            		
            		// use different colour for ships on planet
            		if (isPlanet(ships[i].x, ships[i].y)) {
            			context.fillStyle = "black";
            		}
            		context.fillText(ShipClasses[ships[i].type].symbol, 
            				(ships[i].x - 1) * OFFSET + (OFFSET / 4),
            				(ships[i].y - 1) * OFFSET + (OFFSET / 4 * 3));
            	}
            }
            
            function isPlanet(x, y) {
            	for (var i = 0; i < planets.length; i++) {
            		if (planets[i].x == x && planets[i].y == y) {
            			return true;
            		}
            	}
            	
            	return false;
            }
            
            function getMousePos(canvas, evt){
            	// get canvas position
            	var obj = canvas;
            	var top = 0;
            	var left = 0;
            	while (obj.tagName != 'BODY') {
            		top += obj.offsetTop;
            		left += obj.offsetLeft;
            		obj = obj.offsetParent;
            	}
 
            	// return relative mouse position
            	var mouseX = evt.clientX - left + window.pageXOffset;
            	var mouseY = evt.clientY - top + window.pageYOffset;
            	return {
            		x: Math.floor(mouseX / OFFSET) + 1,
            		y: Math.floor(mouseY / OFFSET) + 1
            	};
            }
            
            function Planet(x, y, player) {
            	this.x = x;
            	this.y = y;
            	this.player = player;
            }
            
            function Player(id, name, resources, colour) {
            	this.id = id;
            	this.name = name;
            	this.resources = resources;
            	this.colour = colour;
            }
            
            function ShipType(cost, movement, strength, symbol) {
            	this.cost = cost;
            	this.movement = movement;
            	this.strength = strength;
            	this.symbol = symbol;
            }
            
            function Ship(type, player, x, y) {
            	this.type = type;
            	this.player = player;
            	this.x = x;
            	this.y = y;
            }
 
        </script>
    </head>
    <body style="background-color:black;">
        <canvas id="myCanvas" width="800" height="600">
        </canvas>
    </body>
</html>
